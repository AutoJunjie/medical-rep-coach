# Med Coach - 医药代表智能培训系统

Med Coach 是一款基于AI的交互式培训工具，专为医药代表设计，旨在通过模拟真实的医患对话场景来提升沟通技巧和产品知识。系统集成了实时语音转录、智能对话生成和专业评估功能，为医药代表提供沉浸式的培训体验。

![PharmaRep Coach Demo](assets/demo.png)

## 📋 目录

- [核心功能](#-核心功能)
- [技术架构](#-技术架构)
- [系统要求](#-系统要求)
- [快速开始](#-快速开始)
- [详细使用指南](#-详细使用指南)
- [故障排除](#-故障排除)
- [项目状态](#-项目状态)
- [贡献指南](#-贡献指南)

## ✨ 核心功能

### 🎭 智能对话模拟
- **动态医生角色**: 根据科室和场景生成不同性格和专业背景的虚拟医生
- **真实场景还原**: 模拟门诊、查房、学术会议等多种临床环境
- **个性化难度**: 基础、中级、高级三个难度等级，适应不同水平的代表

### 🎤 实时语音交互
- **流式语音转录**: 基于AWS Transcribe的实时语音识别，支持中文
- **智能文本处理**: 自动去重和优化转录结果，提供流畅的交互体验
- **多模态输入**: 支持语音输入和文字输入两种方式

### 🧠 AI智能评估
- **实时反馈**: 对每次回复进行即时评估，指出优点和改进建议
- **专业评价**: 从医学准确性、沟通技巧、说服力等多维度评估
- **训练报告**: 生成详细的训练总结，追踪学习进度

### 📊 数据驱动优化
- **对话历史**: 完整记录训练过程，便于回顾和分析
- **性能统计**: 跟踪转录准确率、响应时间等技术指标
- **学习轨迹**: 记录培训进展，支持个性化学习路径

## 🛠 技术架构

### 系统架构
Med Coach 采用前后端分离的架构设计：

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   前端静态页面   │    │   后端Flask服务  │    │   AWS云服务     │
│                │    │                │    │                │
│ • index.html   │◄──►│ • HTTP API     │◄──►│ • Transcribe   │
│ • JavaScript   │    │ • WebSocket    │    │ • S3 Storage   │
│ • Web Audio    │    │ • 对话管理      │    │ • Bedrock AI   │
│                │    │                │    │                │
│ Port: 5001     │    │ Port: 18080    │    │                │
└─────────────────┘    │ WebSocket:18765│    └─────────────────┘
                       └─────────────────┘
                               │
                    ┌─────────────────┐
                    │   OpenAI API    │
                    │                │
                    │ • GPT模型      │
                    │ • 对话生成      │
                    └─────────────────┘
```

### 技术栈
**后端 (main.py)**:
- Python Flask - Web应用框架
- WebSocket - 实时双向通信
- AWS Transcribe - 流式语音转录
- OpenAI/AWS Bedrock - 大语言模型
- Strands Agents - 智能对话代理

**前端 (index.html)**:
- 原生HTML/CSS/JavaScript
- Web Audio API - 音频采集处理
- WebSocket Client - 实时通信
- 响应式设计 - 多设备适配

## 📋 系统要求

### 基础环境
- **Python**: 3.10 或更高版本
- **pip**: Python包管理器
- **现代浏览器**: Chrome 66+, Firefox 76+, Safari 11+, Edge 79+

### 浏览器功能要求
- ✅ Web Audio API 支持
- ✅ WebSocket 支持
- ✅ getUserMedia API 支持
- ✅ 麦克风访问权限

### 云服务要求
- **AWS账户**: 用于Transcribe语音转录和S3存储
- **AI服务**: OpenAI API 或 AWS Bedrock 访问权限

## 🚀 快速开始

### 5分钟快速上手

#### 第一步：环境准备
```bash
# 1. 克隆项目（如果需要）
git clone https://github.com/your-repo/medical-rep-coach.git
cd medical-rep-coach

# 2. 创建并激活虚拟环境
python -m venv venv

# Windows
venv\Scripts\activate
# macOS/Linux
source venv/bin/activate

# 3. 安装依赖
pip install -r requirements.txt
```

#### 第二步：配置环境变量
```bash
# 复制配置模板
cp .env.example .env

# 编辑 .env 文件，配置以下必需参数：
```

**必需配置项：**
```env
# AWS 配置 (用于语音转录)
AWS_ACCESS_KEY_ID=your_aws_access_key_id
AWS_SECRET_ACCESS_KEY=your_aws_secret_access_key
AWS_REGION=us-east-1
S3_BUCKET=your_s3_bucket_name

# AI模型配置 (选择其一)
# Option 1: OpenAI
OPENAI_API_KEY=your_openai_api_key
OPENAI_BASE_URL=https://api.openai.com/v1
OPENAI_MODEL_ID=gpt-4

# Option 2: AWS Bedrock
BEDROCK_MODEL_ID=anthropic.claude-3-sonnet-20240229-v1:0
```

#### 第三步：启动应用

**方式一：一键启动（推荐）**
```bash
# 使用完整启动脚本，自动启动前后端
python start_app.py
```
这将启动：
- 后端服务器: http://127.0.0.1:18080 (Flask + WebSocket)
- 前端服务器: http://127.0.0.1:5001 (静态文件)
- 自动打开浏览器

**方式二：分别启动**
```bash
# 终端1：启动后端服务
python main.py

# 终端2：启动前端服务
python -m http.server 5001

# 然后在浏览器中访问: http://127.0.0.1:5001
```

#### 第四步：开始使用
1. 浏览器会自动打开并访问：`http://127.0.0.1:5001`
2. 配置训练参数：
   - 药品名称：如"阿司匹林"
   - 目标科室：如"心内科"
   - 难度等级：选择"基础"开始
3. 点击【开始训练】
4. 使用🎤语音输入或直接文字输入与AI医生对话

### 🎯 首次使用建议

#### 推荐配置
- **药品**: 阿司匹林、胰岛素、降压药等常见药物
- **科室**: 心内科、内分泌科、神经科等
- **难度**: 从"基础"开始，逐步提升

#### 语音使用技巧
- 📱 确保麦克风权限已开启
- 🔇 在安静环境中使用
- 🗣️ 清晰、适中语速说话
- ⏸️ 说完后稍等片刻再停止录音

## 📖 详细使用指南

### 基本操作流程

#### 1. 配置训练参数
- **药品名称**: 输入要练习推广的药品（如：阿司匹林、胰岛素等）
- **目标科室**: 选择科室（如：心内科、内分泌科、神经科等）
- **难度等级**: 
  - **基础**: 适合新手，医生较为友好配合
  - **中级**: 医生会提出一些专业问题和质疑
  - **高级**: 医生较为严格，需要深度专业知识

#### 2. 开始训练
点击【开始训练】按钮，系统将：
- 生成虚拟医生档案
- 创建对话场景
- 启动实时评估系统

#### 3. 进行对话

**语音输入方式：**
- 点击🎤麦克风按钮开始录音
- 清晰说话，系统会实时显示转录结果
- 再次点击按钮停止录音并发送

**文字输入方式：**
- 直接在输入框中输入文字
- 按Enter键或点击发送按钮

#### 4. 查看反馈
- **左侧对话区**: 显示与医生的完整对话历史
- **右侧评估区**: 实时显示AI教练的专业评估和建议

#### 5. 结束训练
点击【结束训练】按钮，系统会生成：
- 完整的对话记录
- 详细的表现分析
- 改进建议和学习要点

### 高级功能

#### 语音转录优化
- **实时显示**: 边说话边显示转录结果，提供即时反馈
- **智能去重**: 自动处理重复文本，确保转录结果清晰
- **错误纠正**: 支持手动编辑转录结果

#### 智能评估系统
- **多维度评价**: 从专业性、沟通技巧、逻辑性等角度评估
- **个性化建议**: 基于具体表现提供针对性改进建议
- **学习追踪**: 记录历史表现，跟踪学习进度

## 🔧 故障排除

### 常见问题及解决方案

#### 启动问题

**问题**: 端口被占用
**解决方案**:
```bash
# 检查端口占用
netstat -an | grep 18080  # 后端端口
netstat -an | grep 5001   # 前端端口
netstat -an | grep 18765  # WebSocket端口

# 如果端口被占用，可以修改端口或停止占用进程
```

**问题**: 环境变量配置错误
**解决方案**:
```bash
# 检查.env文件是否存在
ls -la .env

# 验证关键环境变量
python -c "from dotenv import load_dotenv; load_dotenv(); import os; print('AWS_REGION:', os.getenv('AWS_REGION'))"
```

#### 语音转录问题

**问题**: 转录结果重复或不准确
**解决方案**:
- 确保网络连接稳定
- 检查麦克风权限设置
- 在安静环境中使用
- 清晰、适中语速说话

**问题**: 无法访问麦克风
**解决方案**:
- 检查浏览器麦克风权限
- 确认麦克风设备正常工作
- 尝试刷新页面重新授权

#### 连接问题

**问题**: WebSocket连接失败
**解决方案**:
- 确认后端服务正在运行 (`python main.py`)
- 检查端口18765是否被占用
- 检查防火墙设置
- 确保前后端都在运行

**问题**: AI回复缓慢或失败
**解决方案**:
- 检查API密钥配置
- 确认网络连接稳定
- 查看控制台错误信息

#### 依赖问题

**问题**: 依赖包安装失败
**解决方案**:
```bash
# 升级pip
pip install --upgrade pip

# 清理缓存重新安装
pip cache purge
pip install -r requirements.txt
```

### 性能优化建议

#### 音频设置优化
- 使用高质量麦克风
- 确保安静的使用环境
- 调整麦克风音量到适中水平

#### 系统性能优化
- 关闭不必要的浏览器标签页
- 确保充足的系统内存
- 使用有线网络连接（如可能）

### 调试工具

#### 检查系统状态
```bash
# 检查Python环境
python --version
pip list | grep flask

# 测试AWS连接
python test_transcribe_api.py

# 检查服务状态
curl http://127.0.0.1:18080/websocket-port
```

#### 浏览器调试
- 打开开发者工具 (F12)
- 查看Console标签页的错误信息
- 检查Network标签页的WebSocket连接状态

## 📊 项目状态

### 当前版本: v1.2.0
**更新日期**: 2025-07-03

### ✅ 已实现功能

#### 核心功能
- [x] **智能对话模拟** - AI医生角色生成和对话
- [x] **实时语音转录** - AWS Transcribe流式转录
- [x] **多模态输入** - 支持语音和文字输入
- [x] **实时评估反馈** - AI教练实时评价和建议
- [x] **训练报告生成** - 详细的训练总结和分析

#### 技术特性
- [x] **WebSocket实时通信** - 低延迟双向通信
- [x] **流式音频处理** - 实时音频数据传输
- [x] **智能文本处理** - 解决转录重复问题
- [x] **错误处理机制** - 自动回退和错误恢复
- [x] **跨平台兼容** - 支持主流浏览器和操作系统

### 🔧 最近修复的问题

#### 语音转录优化 (v1.2.0)
- ✅ **修复转录重复问题** - 优化partial/final结果处理逻辑
- ✅ **改进文本状态管理** - 分离确认文本和临时文本
- ✅ **增强音频处理精度** - 更精确的PCM数据转换
- ✅ **添加调试信息** - 便于问题诊断和监控

### 📈 性能指标

#### 语音转录性能
- **延迟**: < 500ms (实时转录)
- **准确率**: 85-95% (取决于音频质量)
- **支持语言**: 中文普通话
- **音频格式**: PCM 16kHz 单声道

#### 系统响应性能
- **WebSocket连接**: < 100ms
- **AI回复生成**: 2-5秒
- **页面加载**: < 2秒
- **内存占用**: < 100MB

### 🔮 发展路线图

#### 短期目标 (1-2周)
- [ ] **多语言支持** - 添加英文转录支持
- [ ] **音频质量检测** - 自动检测和提示音频问题
- [ ] **训练历史记录** - 保存和回顾历史训练会话

#### 中期目标 (1-2月)
- [ ] **用户管理系统** - 多用户支持和权限管理
- [ ] **训练数据分析** - 深度学习进度分析
- [ ] **自定义医生角色** - 用户自定义医生性格和背景

#### 长期目标 (3-6月)
- [ ] **云端部署** - AWS/Azure云端部署方案
- [ ] **企业版功能** - 团队管理和批量培训
- [ ] **API开放平台** - 第三方集成接口

## 🔒 安全与隐私

### 数据安全
- 语音数据仅用于实时转录，不会永久存储
- 对话内容在本地处理，保护隐私安全
- AWS服务遵循企业级安全标准

### 隐私保护
- 不收集个人身份信息
- 训练数据仅用于改进用户体验
- 支持本地部署，完全控制数据流向

### 安全最佳实践
- 定期更新依赖包
- 使用环境变量管理敏感信息
- 启用HTTPS（生产环境）
- 定期备份重要数据

## 🤝 贡献指南

我们欢迎社区贡献！如果您想参与项目开发：

### 贡献方式
1. Fork 项目仓库
2. 创建功能分支 (`git checkout -b feature/AmazingFeature`)
3. 提交更改 (`git commit -m 'Add some AmazingFeature'`)
4. 推送到分支 (`git push origin feature/AmazingFeature`)
5. 创建 Pull Request

### 开发规范
- 遵循PEP 8 Python代码规范
- 添加适当的注释和文档
- 编写单元测试
- 更新相关文档

### 报告问题
- 使用GitHub Issues报告bug
- 提供详细的错误信息和重现步骤
- 包含系统环境信息

## 📄 许可证

本项目采用 MIT 许可证 - 查看 [LICENSE](LICENSE) 文件了解详情。

## 📞 支持与反馈

如果您在使用过程中遇到问题或有改进建议：

- 📧 邮箱: support@medcoach.ai
- 🐛 问题反馈: [GitHub Issues](https://github.com/your-repo/medical-rep-coach/issues)
- 💬 讨论交流: [GitHub Discussions](https://github.com/your-repo/medical-rep-coach/discussions)

### 常用命令速查

```bash
# 一键启动（推荐）
python start_app.py

# 分别启动
python main.py                    # 后端服务
python -m http.server 5001       # 前端服务

# 测试功能
python test_transcribe_api.py     # 测试转录API

# 检查依赖
pip list

# 停止服务
Ctrl + C
```

### 端口说明
- **前端页面**: http://127.0.0.1:5001
- **后端API**: http://127.0.0.1:18080
- **WebSocket**: ws://localhost:18765

---

**Med Coach** - 让每一次沟通都更专业，让每一位医药代表都更自信！ 🚀

*最后更新: 2025-07-03*
